/* Основные стили из исходного проекта (ускоренная версия). Внесены только базовые компоненты */
:root{
  --bg:#090c12;
  --panel:#0f1520;
  --panel-2:#0b111a;
  --text:#ecf2f9;
  --muted:#90a4ba;
  --accent:#69b9ff;
  --accent-2:#39d0c7;
  --ring:#85d0ff;
  --danger:#ff6b6b;
  --ok:#34d399;
  --shadow:0 14px 52px rgba(0,0,0,.6);
  --r:18px;
  --gap:14px;
  --thin:1px;
  --sideW:clamp(14vw,16vw,18vw);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font:600 14px/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans";
  overflow:hidden;
  letter-spacing:.1px;
}
a{color:var(--accent);text-decoration:none}
a:focus-visible,button:focus-visible,select:focus-visible,textarea:focus-visible,[tabindex]:focus-visible{
  outline:2px solid var(--ring);
  outline-offset:2px;
  border-radius:.5rem;
}
.app{
  height:100vh;
  display:grid;
  grid-template-columns:1fr var(--sideW);
  grid-template-rows:auto 1fr;
  gap:var(--gap);
  padding:var(--gap);
}
header{
  grid-column:1/-1;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--panel);
  border-radius:var(--r);
  padding:10px 14px;
  box-shadow:var(--shadow);
}
header .left{display:flex;gap:10px;align-items:center}
.logo{inline-size:28px;block-size:28px;border-radius:9px;background:radial-gradient(120% 100% at 0% 0%,#3a7bd5 0%,transparent 45%),linear-gradient(135deg,#3a7bd5,#3ac6d5)}
h1{font-size:16px;margin:0 4px 0 0;letter-spacing:.2px;font-weight:700}
.controls{display:flex;gap:10px;align-items:center}
button,select,textarea,input[type="checkbox"]{
  background:var(--panel-2);
  color:var(--text);
  border:1px solid #1b2737;
  border-radius:12px;
  padding:8px 10px;
}
button{cursor:pointer;transition:.15s transform ease,.2s background ease}
button:hover{transform:translateY(-1px)}
main{display:grid;grid-template-rows:1fr auto;gap:var(--gap);min-height:0}
.stage{position:relative;background:var(--panel);border-radius:var(--r);display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow);overflow:hidden;min-height:260px;}
canvas{display:block;}
.img-wrap{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);display:block;border-radius:12px;overflow:hidden;box-shadow:0 0 0 1px #1b2433;user-select:none}
.img-wrap img{display:block;width:100%;height:100%;object-fit:contain;image-rendering:auto}
.input-grid{position:absolute;inset:0;display:none;padding:10px;gap:10px;}
.input-grid.show{display:grid}
.tile{position:relative;border-radius:12px;overflow:hidden;background:#0f1318;border:1px solid #1e2633;transition:.18s transform ease,.18s box-shadow ease,.28s opacity ease;display:flex;align-items:center;justify-content:center}
.tile:hover{transform:scale(1.02);box-shadow:0 12px 24px rgba(0,0,0,.35)}
.tile img{width:100%;height:100%;object-fit:contain;display:block;background:linear-gradient(180deg,#0c1219,#0a1016)}
.tile .close{position:absolute;top:6px;right:6px;background:#0f151fdd;border:1px solid #22303f;border-radius:10px;padding:4px;line-height:0}
.tile.active{outline:2px solid var(--accent)}
.grid-1{grid-template-columns:1fr;grid-template-rows:1fr}
.grid-2{grid-template-columns:1fr 1fr;grid-template-rows:1fr}
.grid-3{grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr}
.grid-4{grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr}
.tile.i0.grid-3{grid-column:1/2;grid-row:1/2}
.tile.i1.grid-3{grid-column:2/3;grid-row:1/2}
.tile.i2.grid-3{grid-column:1/3;grid-row:2/3}
.top-left{position:absolute;top:10px;left:10px;z-index:3}
.badge{background:#0f151fee;border:1px solid #223243;color:#d8e7f7;padding:6px 10px;border-radius:999px;font-size:12px;box-shadow:var(--shadow)}
.hidden{display:none}
.top-right{position:absolute;top:10px;right:10px;display:flex;gap:8px;z-index:3}
.icon-btn{background:#0f151fdd;border:1px solid #22303f;border-radius:12px;padding:6px;display:inline-flex;align-items:center;justify-content:center}
.dropzone{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:auto;border:2px dashed #243140;color:#90a4ba;border-radius:var(--r);margin:10px;padding:10px;text-align:center}
.dropzone.hide{display:none}
.dz-inner{opacity:.95}
.paste-hint{font-size:12px;opacity:.85;margin-top:6px}
.carousel-nav{position:absolute;inset-block:0;inset-inline:0;display:none;pointer-events:none}
.carousel-nav.active{display:block}
.nav-btn{position:absolute;top:50%;translate:0 -50%;background:#0f151fdd;border:1px solid #22303f;pointer-events:auto}
.nav-btn.left{left:10px}
.nav-btn.right{right:10px}
.prompt-panel{background:var(--panel);border-radius:var(--r);padding:10px;box-shadow:var(--shadow)}
.prompt-row{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center}
textarea{resize:vertical;min-height:56px;max-height:40vh;background:var(--panel-2);border:1px solid #1b2737;border-radius:12px;padding:10px 12px;font-weight:600}
.tool-btn{display:inline-flex;align-items:center;justify-content:center;padding:10px;border-radius:12px;background:var(--panel-2);border:1px solid #1b2737}
.send-group{display:flex;gap:8px;align-items:center}
.mini-sel{width:64px;text-align:center;font-weight:700}
.ar-sel{min-width:92px}
aside{background:var(--panel);border-radius:var(--r);padding:10px;box-shadow:var(--shadow);overflow:auto}
.details{border:1px solid #1e2633;border-radius:12px;padding:8px;margin-bottom:10px;background:linear-gradient(180deg,#0f151f 0%, #0d141c 100%)}
.d-row{display:grid;grid-template-columns:1fr;gap:6px}
.d-meta{font-size:12px;color:#90a4ba}
.d-prompt{
  width:100%;
  background:var(--panel-2);
  border:1px solid #1b2737;
  border-radius:10px;
  padding:8px;
  font-size:13px;
  color:var(--text);
}
.toast{position:fixed;bottom:20px;left:50%;translate:-50% 0;background:#0f151fee;color:#fff;border:1px solid #22303f;padding:10px 12px;border-radius:12px;box-shadow:var(--shadow);display:none;z-index:100;font-size:14px;font-weight:700;letter-spacing:.2px;transform-origin:50% 100%;opacity:0;transform:translate(-50%,10px) scale(.98);transition:opacity .25s ease, transform .25s ease;}
.toast.show{display:block;opacity:1;transform:translate(-50%,0) scale(1)}
::-webkit-scrollbar{width:10px;height:10px}
::-webkit-scrollbar-thumb{background:#203040;border-radius:8px}

/* --- Дополнительные стили для модальных окон и кроппера --- */

/* Модальные окна затемняют экран и центрируют содержимое */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  place-items: center;
  z-index: 200;
  background: rgba(7,10,14,0.6);
  backdrop-filter: blur(2px);
}
.modal.show,
.modal[style*="display:grid"] {
  display: grid;
}
/* Карточка модального окна */
.modal-card {
  width: min(860px, 94vw);
  max-height: 84vh;
  overflow: auto;
  background: var(--panel);
  border: 1px solid #22303f;
  border-radius: 16px;
  box-shadow: var(--shadow);
  padding: 14px;
  display: flex;
  flex-direction: column;
}
/* Заголовок модального окна */
.modal-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 8px;
}
.modal-title {
  font-weight: 800;
  font-size: 16px;
}
/* Кнопки в модалях */
.btn {
  background: #0f151f;
  border: 1px solid #22303f;
  padding: 8px 12px;
  border-radius: 10px;
  color: #eaf2ff;
  cursor: pointer;
}
.btn.primary {
  background: linear-gradient(180deg, #1a2a3d, #162233);
  border-color: #2b3d53;
}
.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
/* Контейнер для размещения элементов в один ряд */
.row {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}
.grow {
  flex: 1 1 auto;
}
.small {
  font-size: 12px;
  opacity: .85;
}

/* Мини‑переключатель для фиксации AR внутри кроппера */
.switch.inline {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #bcd;
}
.switch.inline input {
  width: 40px;
  height: 22px;
  appearance: none;
  background: #122131;
  border: 1px solid #203244;
  border-radius: 22px;
  position: relative;
  cursor: pointer;
}
.switch.inline input:after {
  content: "";
  position: absolute;
  width: 18px;
  height: 18px;
  top: 1px;
  left: 1px;
  background: #cfe6ff;
  border-radius: 50%;
  transition: .18s;
}
.switch.inline input:checked:after {
  left: 19px;
}